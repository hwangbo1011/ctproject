<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í•­ìƒì œ ë‚´ì„± ì‹œë®¬ë ˆì´í„°</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; margin: 40px; line-height: 1.6; }
  .story { background-color: #eef6ff; padding: 18px; border-left: 5px solid #3498db; margin-bottom: 20px; border-radius: 8px; }
  .box { border: 1px solid #ccc; padding: 16px; margin-bottom: 20px; border-radius: 8px; background: #f9f9f9; }
  .timer { font-weight: bold; font-size: 18px; color: red; margin-top:10px; }
  button { margin-top: 10px; padding: 6px 14px; font-size: 15px; cursor: pointer; }
  .overlay {
    display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000;
  }
  .popup { background:#fff; padding:20px; border-radius:10px; text-align:center; width:300px; }
  .popup button { margin-top: 15px; }
  .progress-container {
    width: 100%; background: #ddd; border-radius: 8px; overflow: hidden; margin-top: 10px;
    height: 20px;
  }
  .progress-bar {
    height: 100%; width: 100%; background: green; transition: width 0.5s ease, background 0.5s ease;
  }
  .answer-correct { color: green; font-weight: bold; }
  .answer-wrong { color: red; font-weight: bold; }
</style>
</head>
<body>

<h1>ğŸ§¬ ì‚´ì•„ë‚¨ëŠ” ìë“¤ì˜ ë²•ì¹™ - í•­ìƒì œ ë‚´ì„± ì‹œë®¬ë ˆì´í„°</h1>

<div class="story">
  <strong>ë¬¸ì œ:</strong><br>
  í•­ìƒì œë¥¼ íˆ¬ì—¬í–ˆì„ ë•Œ ì‚´ì•„ë‚¨ì„ ìˆ˜ ìˆëŠ” ì„¸ê· ì„ ì°¾ëŠ” ë¯¸ì…˜ì…ë‹ˆë‹¤.<br>
  ë‚œì´ë„ê°€ ë†’ì•„ì§ˆìˆ˜ë¡ ì„¸ê·  ìˆ˜, ìœ ì „ì ì¢…ë¥˜, í•­ìƒì œ ì¢…ë¥˜, í•„ìš” ìœ ì „ì ê°œìˆ˜ê°€ ëŠ˜ì–´ë‚©ë‹ˆë‹¤.
</div>

<div class="box">
  <label>ë‚œì´ë„:
    <select id="difficultySelect" onchange="updateDifficultyInfo()">
      <option value="easy">ì‰¬ì›€</option>
      <option value="medium">ë³´í†µ</option>
      <option value="hard">ì–´ë ¤ì›€</option>
    </select>
  </label>
  <p id="difficultyInfo" style="font-style: italic; color: #555;"></p>
  
  <label>ì‹œê°„ ì„¤ì •:
    <select id="timeSelect">
      <option value="30">30ì´ˆ</option>
      <option value="60">1ë¶„</option>
      <option value="90">1ë¶„ 30ì´ˆ</option>
      <option value="120">2ë¶„</option>
    </select>
  </label>
  <button onclick="startChallenge()">ë¬¸ì œ í’€ê¸°</button>
  <div class="timer" id="timerDisplay"></div>
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
</div>

<div id="challengeArea" style="display:none;">
  <div class="box">
    <p><strong>í•­ìƒì œ ì¡°ê±´:</strong></p>
    <div id="antibioticList"></div>
  </div>

  <div class="box">
    <p><strong>ì„¸ê·  ëª©ë¡:</strong></p>
    <ul id="bacteriaListUI"></ul>
  </div>

  <div class="box">
    <p><strong>ì •ë‹µ ì…ë ¥:</strong></p>
    <input type="text" id="userAnswer" placeholder="ì˜ˆ: 1,3,5">
    <button onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
    <p id="answerResult"></p>
    <div id="retryButtonArea"></div>
  </div>

  <div class="result" id="result"></div>
</div>

<div class="overlay" id="popupOverlay">
  <div class="popup">
    <h2>â° ì‹œê°„ ì´ˆê³¼!</h2>
    <p>ë‹¤ì‹œ ë„ì „í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
    <button onclick="restartChallenge()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
  </div>
</div>

<script>
let countdown;
let remainingTime;
let totalTime;
let correctSurvivors = [];
let antibioticsData = {};

const difficultySettings = {
  easy: { count: 5, genes: ['R1','R2','R3','R4'], antibiotics: 2, genesPerAntibiotic: [1,1], info: "ì„¸ê·  5ë§ˆë¦¬, í•­ìƒì œ 2ì¢…, ê° í•­ìƒì œë‹¹ 1ê°œ ìœ ì „ì í•„ìš”" },
  medium: { count: 7, genes: ['R1','R2','R3','R4','R5'], antibiotics: 3, genesPerAntibiotic: [1,2], info: "ì„¸ê·  7ë§ˆë¦¬, í•­ìƒì œ 3ì¢…, ê° í•­ìƒì œë‹¹ 1~2ê°œ ìœ ì „ì í•„ìš”" },
  hard: { count: 10, genes: ['R1','R2','R3','R4','R5','R6','R7'], antibiotics: 4, genesPerAntibiotic: [2,3], info: "ì„¸ê·  10ë§ˆë¦¬, í•­ìƒì œ 4ì¢…, ê° í•­ìƒì œë‹¹ 2~3ê°œ ìœ ì „ì í•„ìš”" }
};

function updateDifficultyInfo() {
  const difficulty = document.getElementById('difficultySelect').value;
  document.getElementById('difficultyInfo').innerText = difficultySettings[difficulty].info;
}

function randomGenes(pool, range) {
  const count = Math.floor(Math.random()*(range[1]-range[0]+1)) + range[0];
  const shuffled = [...pool].sort(() => 0.5 - Math.random());
  return shuffled.slice(0,count);
}

function generateAntibiotics(difficulty) {
  const { antibiotics, genes, genesPerAntibiotic } = difficultySettings[difficulty];
  const antibioticList = document.getElementById('antibioticList');
  antibioticList.innerHTML = '';
  antibioticsData = {};

  const names = ['A','B','C','D'];
  for (let i=0; i<antibiotics; i++) {
    const reqGenes = randomGenes(genes, genesPerAntibiotic);
    antibioticsData[names[i]] = reqGenes;
    const p = document.createElement('p');
    p.textContent = `í•­ìƒì œ ${names[i]} í•„ìš” ìœ ì „ì: ${reqGenes.join(', ')}`;
    antibioticList.appendChild(p);
  }
}

function generateRandomBacteriaList(count, genesPool) {
  const bacteriaList = document.getElementById('bacteriaListUI');
  bacteriaList.innerHTML = '';
  for (let i = 1; i <= count; i++) {
    const numGenes = Math.floor(Math.random() * 2) + 2;
    const shuffled = [...genesPool].sort(() => 0.5 - Math.random());
    const selectedGenes = shuffled.slice(0, numGenes);
    const li = document.createElement('li');
    li.textContent = `ì„¸ê·  ${i}: [${selectedGenes.join(', ')}]`;
    bacteriaList.appendChild(li);
  }
}

function startChallenge() {
  const difficulty = document.getElementById('difficultySelect').value;
  const { count, genes } = difficultySettings[difficulty];
  
  totalTime = parseInt(document.getElementById('timeSelect').value);
  remainingTime = totalTime;
  
  generateAntibiotics(difficulty);
  generateRandomBacteriaList(count, genes);
  calculateCorrectSurvivors();

  document.getElementById('timerDisplay').innerText = `ë‚¨ì€ ì‹œê°„: ${remainingTime}ì´ˆ`;
  document.getElementById('challengeArea').style.display = 'block';
  document.getElementById('progressBar').style.width = "100%";
  document.getElementById('progressBar').style.background = "green";
  document.getElementById('retryButtonArea').innerHTML = '';

  clearInterval(countdown);
  countdown = setInterval(() => {
    remainingTime--;
    document.getElementById('timerDisplay').innerText = `ë‚¨ì€ ì‹œê°„: ${remainingTime}ì´ˆ`;

    let percent = (remainingTime / totalTime) * 100;
    document.getElementById('progressBar').style.width = percent + "%";

    if (percent <= 50 && percent > 20) {
      document.getElementById('progressBar').style.background = "orange";
    } else if (percent <= 20) {
      document.getElementById('progressBar').style.background = "red";
    }

    if (remainingTime <= 0) {
      clearInterval(countdown);
      document.getElementById('popupOverlay').style.display = 'flex';
    }
  }, 1000);
}

function restartChallenge() {
  document.getElementById('popupOverlay').style.display = 'none';
  document.getElementById('challengeArea').style.display = 'none';
  document.getElementById('timerDisplay').innerText = '';
}

function calculateCorrectSurvivors() {
  correctSurvivors = [];
  const bacteriaItems = document.querySelectorAll('#bacteriaListUI li');
  
  bacteriaItems.forEach((item, idx) => {
    const genesText = item.textContent.match(/\[(.*?)\]/)[1];
    const genes = genesText.split(',').map(g => g.trim());
    let survives = true;
    for (let drug in antibioticsData) {
      const req = antibioticsData[drug];
      if (!req.every(r => genes.includes(r))) {
        survives = false;
        break;
      }
    }
    if (survives) correctSurvivors.push(idx+1);
  });
}

function checkAnswer() {
  clearInterval(countdown);

  const userInput = document.getElementById('userAnswer').value.trim();
  const userArray = userInput.split(',').map(n => parseInt(n.trim())).filter(Boolean);

  if (JSON.stringify(userArray.sort()) === JSON.stringify(correctSurvivors.sort())) {
    document.getElementById('answerResult').innerHTML = `<span class="answer-correct">ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰</span>`;
  } else {
    document.getElementById('answerResult').innerHTML = `<span class="answer-wrong">ì˜¤ë‹µì…ë‹ˆë‹¤. ğŸ˜¢ ì •ë‹µ: ${correctSurvivors.join(', ')}</span>`;
  }

  document.getElementById('retryButtonArea').innerHTML = `<button onclick="startChallenge()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>`;
}

updateDifficultyInfo();
</script>

</body>
</html>
