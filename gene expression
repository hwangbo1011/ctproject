<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>비버챌린지 유전자 문제</title>
<style>
    body { font-family: Arial, sans-serif; background: #f8f9fa; margin: 20px; }
    .container { max-width: 900px; margin: auto; }
    .title { text-align: center; font-size: 24px; font-weight: bold; margin-bottom: 20px; }
    .box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .story { background: #eef6ff; padding: 10px; border-left: 5px solid #007bff; margin-bottom: 15px; }
    table { border-collapse: collapse; margin: 10px 0; width: 100%; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: center; }
    .activator { color: green; font-weight: bold; }
    .repressor { color: red; font-weight: bold; }
    .options label { display: block; padding: 8px; background: #e9ecef; margin: 5px 0; border-radius: 5px; cursor: pointer; }
    .options input { margin-right: 10px; }
    button { padding: 10px 15px; margin-top: 15px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .result { margin-top: 15px; font-weight: bold; }
    .timer { font-weight: bold; font-size: 18px; color: #d9534f; text-align: right; }
    /* 팝업 스타일 */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
             background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 20px; border-radius: 10px; text-align: center; }
    /* 난이도별 테이블 스타일 */
.easy table { background: #f9fff9; }
.medium table { background: #f9f9ff; }
.hard table { 
    background: #fff9f9; 
    width: 100%;           /* 폭 확장 */
    font-size: 14px;       /* 글씨 크기 줄임 */
}
.hard table th, .hard table td {
    padding: 4px;          /* 간격 줄이기 */
}
</style>
</head>
<body>

<div class="container">
    <div class="title">🦫 비버챌린지 - 유전자 발현 스위치</div>
    
    <!-- 스토리 -->
    <div class="box">
        <div class="story">
            🧬 <b>비버 연구소의 실험 일지</b><br>
            비버 과학자 팀은 새로운 합성 유전자를 개발 중입니다.  
            각 유전자는 특정 전사인자가 모두 결합하고 억제인자가 방해하지 않을 때만 단백질을 만듭니다.  
            오늘, 실험 장치에 전사인자와 억제인자가 주어졌을 때 어떤 유전자가 켜질지(발현될지) 알아내는 것이 당신의 임무입니다.
        </div>
        <p><b>규칙:</b> 전사인자가 모든 필요한 자리에 결합하고, 억제인자가 결합하지 않으면 발현됩니다.</p>

        <!-- 난이도 + 시간 설정 -->
        <label for="difficulty">난이도 선택:</label>
        <select id="difficulty">
            <option value="easy">쉬움</option>
            <option value="medium">보통</option>
            <option value="hard">어려움</option>
        </select>
        <br><br>
        <label for="timeSelect">시간 선택:</label>
        <select id="timeSelect">
            <option value="30">30초</option>
            <option value="60">1분</option>
            <option value="90">1분 30초</option>
            <option value="120">2분</option>
        </select>
        <br><br>
        <button onclick="startQuiz()">문제 풀기</button>
    </div>

    <!-- 문제 박스 -->
    <div class="box" id="questionBox" style="display:none;">
        <div class="timer" id="timer">남은 시간: --</div>
        <div id="geneTable"></div>
        <p id="currentFactors"></p>
        <div class="options" id="optionsBox"></div>
        <button onclick="checkAnswer()">정답 확인</button>
        <div class="result" id="result"></div>
        <button id="retryBtn" style="display:none;" onclick="retry()">다시 도전하기</button>
    </div>
</div>

<!-- 팝업 -->
<div class="modal" id="timeoutModal">
    <div class="modal-content">
        <h3>⏳ 시간 초과!</h3>
        <p>다시 도전하시겠습니까?</p>
        <button onclick="retry()">다시 도전하기</button>
    </div>
</div>

<script>
let timerInterval;
let timeLeft;
let correctAnswer = "";
let genesData = [];

function startQuiz() {
    generateQuestion();
    document.getElementById("questionBox").style.display = "block";
    document.getElementById("retryBtn").style.display = "none";
    timeLeft = parseInt(document.getElementById("timeSelect").value);
    updateTimer();
    clearInterval(timerInterval);
    timerInterval = setInterval(countdown, 1000);
}

function updateTimer() {
    document.getElementById("timer").textContent = "남은 시간: " + timeLeft + "초";
}

function countdown() {
    timeLeft--;
    updateTimer();
    if (timeLeft <= 0) {
        clearInterval(timerInterval);
        document.getElementById("timeoutModal").style.display = "flex";
    }
}

function generateQuestion() {
    let difficulty = document.getElementById("difficulty").value;
    let geneCount = difficulty === "easy" ? 3 : (difficulty === "medium" ? 5 : 7);
    let activators = ["X", "Y", "Z", "A", "B", "C"];
    let repressors = ["W", "Q", "R", "T", "M"];
    
    genesData = [];
    let activeActivators = activators.sort(() => 0.5 - Math.random()).slice(0, difficulty==="easy"?2: difficulty==="medium"?3:4);
    let activeRepressors = repressors.sort(() => 0.5 - Math.random()).slice(0, difficulty==="easy"?1: difficulty==="medium"?2:3);

    // 유전자 랜덤 생성
    for (let i = 0; i < geneCount; i++) {
        let needAct = activators.sort(() => 0.5 - Math.random()).slice(0, difficulty==="easy"?1: difficulty==="medium"?2:3);
        let needRep = Math.random() > 0.5 ? [repressors[Math.floor(Math.random()*repressors.length)]] : [];
        genesData.push({
            name: "Gene" + (i+1),
            activators: needAct,
            repressors: needRep
        });
    }

    // 표 만들기 (난이도별 스타일)
    let tableClass = difficulty === "easy" ? "easy" : difficulty === "medium" ? "medium" : "hard";
    let tableHTML = `<div class="${tableClass}"><table><tr><th>유전자</th><th>필요 전사인자</th><th>억제인자</th></tr>`;
    genesData.forEach(g => {
        tableHTML += `<tr><td>${g.name}</td>
                      <td>${g.activators.map(a=>`<span class='activator'>${a}</span>`).join(", ")}</td>
                      <td>${g.repressors.length>0?g.repressors.map(r=>`<span class='repressor'>${r}</span>`).join(", "):"(없음)"}</td></tr>`;
    });
    tableHTML += `</table></div>`;
    document.getElementById("geneTable").innerHTML = tableHTML;

    // 현재 활성 인자 표시
    document.getElementById("currentFactors").innerHTML = `<b>현재 활성 전사인자:</b> ${activeActivators.join(", ")}<br>
                                                          <b>현재 활성 억제인자:</b> ${activeRepressors.join(", ")}`;

    // 정답 계산
    let activeGenes = genesData.filter(g => g.activators.every(a => activeActivators.includes(a)) && g.repressors.every(r => !activeRepressors.includes(r)));
    correctAnswer = activeGenes.map(g=>g.name).join(", ");

    // 선택지 생성
    let optionsHTML = "";
    let distractors = [correctAnswer, "없음", genesData.slice(0,2).map(g=>g.name).join(", "), genesData.slice(1,3).map(g=>g.name).join(", ")];
    distractors = [...new Set(distractors)];
    distractors.forEach((opt, idx) => {
        optionsHTML += `<label><input type="radio" name="answer" value="${opt}"> ${String.fromCharCode(65+idx)}) ${opt}</label>`;
    });
    document.getElementById("optionsBox").innerHTML = optionsHTML;
}

function checkAnswer() {
    let selected = document.querySelector('input[name="answer"]:checked');
    let resultDiv = document.getElementById("result");

    if (!selected) {
        resultDiv.textContent = "⚠️ 답을 선택하세요.";
        resultDiv.style.color = "red";
        return;
    }

    if (selected.value === correctAnswer) {
        resultDiv.textContent = `✅ 정답! 발현 유전자: ${correctAnswer}`;
        resultDiv.style.color = "green";
        clearInterval(timerInterval); // 타이머 멈춤
        document.getElementById("retryBtn").style.display = "inline-block";
    } else {
        resultDiv.textContent = "❌ 오답입니다. 다시 시도하세요.";
        resultDiv.style.color = "red";
    }
}

function retry() {
    document.getElementById("timeoutModal").style.display = "none";
    document.getElementById("result").textContent = "";
    document.querySelectorAll('input[name="answer"]').forEach(el => el.checked = false);
    document.getElementById("questionBox").style.display = "none";
}
</script>

</body>
</html>
